import { debounce } from './functions.js';
import { generatePhotos } from './generatePhotos.js';
import { getRandomNumber } from './getRandomNumber.js';
import { renderPhotoElements } from './miniatures.js';
import { openBigPicture } from './bigPicture.js';

const photosFilters = document.querySelector('.img-filters');
const photosByDefaultButton = document.getElementById('filter-default');
const photosByRandomButton = document.getElementById('filter-random');
const photosByDiscussedButton = document.getElementById('filter-discussed');
const activeFilterButtopnClass = 'img-filters__button--active';
const renderPhotosDebounced = debounce(renderPhotos);

photosByDefaultButton.addEventListener('click', () => {
  photosByDefaultButton.classList.add(activeFilterButtopnClass);
  photosByRandomButton.classList.remove(activeFilterButtopnClass);
  photosByDiscussedButton.classList.remove(activeFilterButtopnClass);
  renderPhotosDebounced('default');
});

photosByRandomButton.addEventListener('click', () => {
  photosByDefaultButton.classList.remove(activeFilterButtopnClass);
  photosByRandomButton.classList.add(activeFilterButtopnClass);
  photosByDiscussedButton.classList.remove(activeFilterButtopnClass);
  renderPhotosDebounced('random');
});

photosByDiscussedButton.addEventListener('click', () => {
  photosByDefaultButton.classList.remove(activeFilterButtopnClass);
  photosByRandomButton.classList.remove(activeFilterButtopnClass);
  photosByDiscussedButton.classList.add(activeFilterButtopnClass);
  renderPhotosDebounced('discussed');
});

export function renderPhotos(filter) {
  photosFilters.classList.remove('hidden');
  const renderedPhotos = document.querySelectorAll('.picture');
  renderedPhotos.forEach((photo) => photo.remove());
  const photosData = getPhotosDataByFilter(filter);
  renderPhotoElements(photosData, openBigPicture);
}

function getPhotosDataByFilter(filter) {
  const allPhotosData = generatePhotos();

  if (filter === 'default') {
    return allPhotosData;
  }

  if (filter === 'random') {
    const photosToRender = 10;
    const photos = [];
    for (let i = 0; i < photosToRender; i++) {
      const randomIndex = getRandomNumber(0, allPhotosData.length - 1);
      const randomPhoto = allPhotosData.splice(randomIndex, 1)[0];
      photos.push(randomPhoto);
    }
    return photos;
  }

  if (filter === 'discussed') {
    return allPhotosData.sort((photo1,photo2) => {
      if (photo1.comments.length === photo2.comments.length) {
        return 0;
      }
      if (photo1.comments.length > photo2.comments.length) {
        return -1;
      }
      return 1;
    });
  }
}

